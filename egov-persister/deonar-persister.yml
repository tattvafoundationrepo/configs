serviceMaps:
  serviceName: deonar-services
  mappings:
    - version: 1.0
      description: Persists Deonar arrival details
      fromTopic: topic_deonar_arrival
      isTransaction: true
      queryMaps:
        - query:  |
                  INSERT INTO eg_deonar_arrival 
                  (arrivalId, importPermission, stakeholderId, dateOfArrival, timeOfArrival, vehicleNumber, createdAt, updatedAt, createdBy, updatedBy) 
                  VALUES (?,?, ?, ?, ?, ?, ?, ?, ?, ?)
                  RETURNING id;
          basePath: $.ArrivalDetails
          jsonMaps:
            - jsonPath: $.ArrivalDetails.arrivalId
            - jsonPath: $.ArrivalDetails.importPermission
            - jsonPath: $.ArrivalDetails.stakeholderId
            - jsonPath: $.ArrivalDetails.dateOfArrival
            - jsonPath: $.ArrivalDetails.timeOfArrival
            - jsonPath: $.ArrivalDetails.vehicleNumber
            - jsonPath: $.ArrivalDetails.createdAt
            - jsonPath: $.ArrivalDetails.updatedAt
            - jsonPath: $.ArrivalDetails.createdBy
            - jsonPath: $.ArrivalDetails.updatedBy
        - query:  |
                  INSERT INTO eg_deonar_animal_at_arrival 
                  (arrivalId, animalTypeId, count, createdAt, updatedAt, createdBy, updatedBy)
                  VALUES ((select id from eg_deonar_arrival  where arrivalId = ?), ?, ?, ?, ?, ?, ?);
          basePath: $.AnimalDetails.* # Reference directly without [*] to align with Java handling
          jsonMaps:
            - jsonPath: $.ArrivalDetails.arrivalId
            - jsonPath: $.AnimalDetails.*.animalTypeId
            - jsonPath: $.AnimalDetails.*.count
            - jsonPath: $.AnimalDetails.*.createdAt
            - jsonPath: $.AnimalDetails.*.updatedAt
            - jsonPath: $.AnimalDetails.*.createdBy
            - jsonPath: $.AnimalDetails.*.updatedBy

    - version: 1.0
      description: Persists Deonar Inspection details
      fromTopic: save-inspection-details
      isTransaction: true
      queryMaps:
        - query: |
            INSERT INTO eg_deonar_animal
            (animalType, animalTokenNum, arrivalId, createdAt, updatedAt, createdBy, updatedBy)
            VALUES ( ?, ?, ?, ?, ?, ?,?) RETURNING id;
          basePath: $.Animal
          jsonMaps:
            - jsonPath: $.Animal.animalType
            - jsonPath: $.Animal.animalTokenNum
            - jsonPath: $.Animal.arrivalId
            - jsonPath: $.Animal.createdAt
            - jsonPath: $.Animal.updatedAt
            - jsonPath: $.Animal.createdBy
            - jsonPath: $.Animal.updatedBy



        - query: |
            INSERT INTO eg_deonar_inspection
            (inspectionDate, inspectionTime, arrivalId, employeeId, animalId, createdAt, updatedAt, createdBy, updatedBy)
            VALUES (?, ?, ?, ?,  (select id from eg_deonar_animal where animalTokenNum = ? ), ?, ?, ?, ?) RETURNING id;
          basePath: $.Inspection
          jsonMaps:
            - jsonPath: $.Inspection.inspectionDate
            - jsonPath: $.Inspection.inspectionTime
            - jsonPath: $.Inspection.arrivalId
            - jsonPath: $.Inspection.employeeId
            - jsonPath: $.Animal.animalTokenNum
            - jsonPath: $.Inspection.createdAt
            - jsonPath: $.Inspection.updatedAt
            - jsonPath: $.Inspection.createdBy
            - jsonPath: $.Inspection.updatedBy

        - query: |
            INSERT INTO eg_deonar_inspection_detail
            (inspectionId, inspectionIndicatorId, inspectionIndicatorValue, createdAt, updatedAt, createdBy, updatedBy)
            VALUES ((SELECT id FROM eg_deonar_inspection WHERE inspectionDate = ?),  ?,  ?, ?, ?, ?,?
            );
          basePath: $.InspectionDetail.*
          jsonMaps:
            - jsonPath: $.Inspection.inspectionDate
            - jsonPath: $.InspectionDetail.*.inspectionIndicatorId
            - jsonPath: $.InspectionDetail.*.inspectionIndicatorValue
            - jsonPath: $.InspectionDetail.*.createdAt
            - jsonPath: $.InspectionDetail.*.updatedAt
            - jsonPath: $.InspectionDetail.*.createdBy
            - jsonPath: $.InspectionDetail.*.updatedBy
